<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="it" xml:lang="it"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Enrico Toffalini">

<title>Open Source per l’Università: Dottorati, corsi di laurea e docenti abbandonino software proprietario se c’è alternativa – home</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nessun risultato",
    "search-matching-documents-text": "documenti trovati",
    "search-copy-link-title": "Copiare il link nella ricerca",
    "search-hide-matches-text": "Nascondere i risultati aggiuntivi",
    "search-more-match-text": "ci sono altri risultati in questo documento",
    "search-more-matches-text": "ulteriori risultati in questo documento",
    "search-clear-button-title": "Pulire",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancellare",
    "search-submit-button-title": "Inviare",
    "search-label": "Ricerca"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Ricerca"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Attiva/disattiva la navigazione" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://enricotoffalini.github.io" target="_blank"> 
<span class="menu-text">enricotoffalini.github.io</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://psicostat.dpss.psy.unipd.it/"> 
<span class="menu-text"><img src="../../images/faviconpsicostat2.png" style="height: 22px; margin-top: -4px;"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/EnricoToffalini"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Open Source per l’Università: Dottorati, corsi di laurea e docenti abbandonino software proprietario se c’è alternativa</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Autore/Autrice</div>
      <div class="quarto-title-meta-contents">
               <p>Enrico Toffalini </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Data di Pubblicazione</div>
      <div class="quarto-title-meta-contents">
        <p class="date">1 dicembre 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="abbandonare-il-software-proprietario-negli-insegnamenti-universitari" class="level2">
<h2 class="anchored" data-anchor-id="abbandonare-il-software-proprietario-negli-insegnamenti-universitari">Abbandonare il software proprietario negli insegnamenti universitari</h2>
<p>Diversi corsi universitari, a vari livelli, si basano tuttora su <strong>software commerciali a licenza onerosa</strong>. Sebbene in alcuni casi tali strumenti offrano funzionalità non facilmente sostituibili, <strong>nella maggior parte dei casi esistono alternative open source, gratuite e ormai assolutamente mainstream</strong> sia nella ricerca internazionale sia nei contesti applicati.</p>
<p>L’anno scorso avevo avanzato una <a href="https://docs.google.com/document/d/1-2Ty2Sd1QQzCCFt3SZpz3hhRkM3XEdvf/" target="_blank"><strong>proposta per l’Open Source</strong></a> <b>all’interno dell’offerta formativa della Scuola di Dottorato in</b> <a href="https://phd.psy.unipd.it/" target="_blank"><strong>Psychological Sciences</strong></a> dell’Università di Padova, dove insegno. La proposta puntava a unificare gli insegnamenti metodologici del dottorato adottando un ecosistema coerente basato su R (per l’analisi statistica) e Python (per la programmazione generale). <strong>L’uso di software proprietari dovrebbe rimanere previsto solo quando strettamente necessario</strong>, previa motivazione esplicita giustificata dall’assenza di alternative, e preferibilmente limitato a corsi opzionali. <strong>Abituarsi e abituare colleghe e colleghi, studentesse e studenti, a usare software proprietari per esigenze di data science (es. SPSS) per le quali esistono alternative open significa produrre competenze più fragili, meno trasferibili e non allineate agli standard internazionali.</strong></p>
<p>Continuare a insegnare a studentesse e studenti software chiusi e costosi presenta diversi rischi, che incidono sulla qualità della formazione e sulla sua equità:</p>
<ul>
<li><strong>Dipendenza economica</strong>: Molte licenze sono disponibili agli utenti solo fintanto che sono incardinati in università (e queste licenze vengono pagate con soldi pubblici). <strong>Una volta conclusi gli studi, chi desidera continuare a utilizzare gli stessi strumenti deve sostenere costi elevati</strong> o cercare finanziamenti. Questa dipendenza economica è <strong>in contrasto con la missione dell’università pubblica</strong>.</li>
<li><strong>Competenze scarsamente trasferibili</strong>: La maggior parte dei contesti accademici e aziendali utilizza ormai soluzioni open source in specifici ambiti, ad esempio R e Python (vedi sotto) per analisi dati, modeling e programmazione. Sul piano della data science queste due piattaforme coprono praticamente tutte le esigenze, salvo casi altamente specialistici (che nella presente proposta sono ammissibili, ma da giustificare esplicitamente caso per caso).</li>
<li><strong>Incoerenza didattica</strong>: Corsi che si basano su strumenti diversi senza una logica unitaria <strong>creano confusione a studentesse e studenti</strong>, trovandosi talvolta a studiare temi complementari o addirittura propedeutici usando software diversi.</li>
</ul>
<p>Gli strumenti open source garantiscono continuità, autonomia e l’accesso a comunità globali attive. Adottare soluzioni libere non è solo una scelta tecnica, ma anche una <strong>scelta politica e culturale</strong>, coerente con i principi dell’Open Science. Peraltro, promuovere attivamente l’uso di software open source implica <strong>un effettivo risparmio per le casse degli atenei</strong>, finanziate prevalentemente, in Italia, dal contribuente pubblico con le tasse.</p>
</section>
<section id="r-e-python-pilastri-della-data-science-alluniversità-e-oltre" class="level2">
<h2 class="anchored" data-anchor-id="r-e-python-pilastri-della-data-science-alluniversità-e-oltre">R e Python: pilastri della data science all’università e oltre</h2>
<p>La <a href="https://docs.google.com/document/d/1-2Ty2Sd1QQzCCFt3SZpz3hhRkM3XEdvf/" target="_blank">proposta che avevo fatto per il dottorato</a> riguardava specialmente <a href="https://www.r-project.org/" target="_blank">R</a> e <a href="https://www.python.org/" target="_blank">Python</a>: i loro immensi ecosistemi, in continuo ampliamento e sempre più integrati tra loro, rappresentano oggi i pilastri fondamentali della data science.</p>
<section id="r" class="level4">
<h4 class="anchored" data-anchor-id="r">R</h4>
<p>È lo <strong>standard globale per l’analisi statistica</strong>, il modeling statistico avanzato, la psicometria, la visualizzazione dei dati e numerosi metodi sviluppati direttamente nella comunità scientifica. È gratuito, supportato da CRAN e dalle community accademiche, ed è progettato da chi fa ricerca per chi fa ricerca. L’enorme ampliamento del suo ecosistema lo proietta già oltre la sola analisi statistica (es. shiny per webapp basate sui dati, Quarto publishing system per produrre siti, libri, blog, ecc.).</p>
</section>
<section id="python" class="level4">
<h4 class="anchored" data-anchor-id="python">Python</h4>
<p>È il <strong>linguaggio di programmazione più usato in assoluto</strong>, incluse le esigenze di data science generale, l’analisi di <em>big data</em>, il <em>machine learning</em> e l’intelligenza artificiale (es. chatGPT è stato sviluppato dentro l’ecosistema Python). È onnipresente nel mondo accademico, aziendale e tecnologico, ed è essenziale per chi opera in contesti interdisciplinari o applicati. Per chi lavora nelle scienze del comportamento è molto utile pure per la programmazione di esperimenti (es. <a href="https://osdoc.cogsci.nl/" target="_blank">OpenSesame</a>, <a href="https://www.psychopy.org/" target="_blank">PsychoPy</a>).</p>
<p>Insieme, <strong>R e Python coprono quasi tutto lo spettro delle competenze necessarie all’elaborazione dati contemporanea</strong>. L’università dovrebbe promuoverne l’utilizzo quanto più possibile per garantire autonomia, continuità e accessibilità della formazione, scegliendo strumenti che non mettano barriere economiche né limitazioni tecniche alla ricerca, e soprattutto che non arrechino danno al futuro di studentesse e studenti dei corsi di dottorato, una volta che saranno ricercatrici e ricercatori indipendenti.</p>
<hr>
<details>
<summary>
<p style="font-size:28px;">
Riferimenti internazionali: <em>Open Science</em> come standard
</p>
</summary>
<p>Open science e open source sono temi gemelli. Non è possibile promuovere davvero l’open science se metodi, dati, analisi e risultati non sono esaminabili e riproducibili da chiunque, ovunque, al minor costo possibile. L’adozione di software libero / open source è coerente con le linee guida internazionali che promuovono infrastrutture open science, trasparenti e sostenibili per la ricerca.</p>
<p><a href="https://www.unesco.org/en/open-science/implementation" target="_blank"><strong>UNESCO (2021) – Recommendation on Open Science</strong></a></p>
<p>La raccomandazione UNESCO definisce un quadro globale per la scienza aperta e invita gli Stati membri a sviluppare:</p>
<ul>
<li><strong>infrastrutture digitali aperte</strong>, comprese piattaforme e strumenti accessibili senza barriere economiche;<br>
</li>
<li><strong>pratiche scientifiche trasparenti e riproducibili</strong>, favorite dall’uso di strumenti ispezionabili;<br>
</li>
<li><strong>equità nell’accesso alla conoscenza</strong>, riducendo dipendenze da licenze e da soluzioni proprietarie.</li>
</ul>
<p><strong>L’uso di software open source nelle università è pienamente coerente con questi principi.</strong></p>
<p><a href="https://rea.ec.europa.eu/open-science_en" target="_blank"><strong>European Commission – Open Science in Horizon Europe (REA)</strong></a></p>
<p>La Commissione Europea definisce l’Open Science come un approccio basato su <strong>condivisione di conoscenza, risultati e strumenti</strong> lungo tutto il ciclo di ricerca, <strong>infrastrutture aperte e interoperabili</strong>, <strong>trasparenza, collaborazione e accessibilità</strong>. Nelle politiche europee, la <strong>ricerca finanziata con fondi pubblici</strong> deve essere resa quanto più aperta possibile (<em>“as open as possible, as closed as necessary”</em>). <strong>L’adozione di strumenti software aperti / open source favorisce la conformità a questo principio</strong>.</p>
<p><a href="https://www.nationalacademies.org/projects/PGA-OFS-16-02" target="_blank"><strong>National Academies (USA) - Open Science by Design (2018)</strong></a></p>
<p>Il rapporto propone la scienza aperta come modello per la ricerca moderna e sottolinea che le pratiche scientifiche dovrebbero basarsi su strumenti: <strong>verificabili</strong>, <strong>modificabili</strong>, <strong>accessibili</strong>. <strong>L’uso di software proprietario nelle università ostacola ovviamente tali condizioni</strong> e limita la formazione alle pratiche di ricerca contemporanee.</p>
</details>
<hr>
<blockquote class="blockquote">
<p>A margine (tema diverso, andrebbe fatto un discorso a parte) vale la pena segnalare la contraddizione della dotazione informatica di base. Da utente pragmatico (tutto quanto detto sopra non è una crociata idealista: è una posizione puramente pragmatica) finisco per essere “Windows user” per forza: l’università fornisce ai docenti esclusivamente computer con Microsoft Windows preinstallato, acquistando licenze pagate con fondi pubblici. Vero è che Microsoft rappresenta di fatto l’opzione mainstream nel suo ambito (al contrario di altri software proprietari), ma questo obbligo implicito finisce per rafforzare uno standard contrario all’open source, scoraggiando istituzionalmente l’adozione di strumenti liberi (es. Linux) anche dentro un contesto (quello universitario) che sarebbe più che predisposto e capace di accoglierli. I dispositivi forniti non sono progettati né configurati per facilitarne l’utilizzo. Ne deriva una dipendenza istituzionale da un unico fornitore commerciale, in contrasto con i principi di autonomia e di buona gestione del denaro pubblico.</p>
</blockquote>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiato!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiato!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>